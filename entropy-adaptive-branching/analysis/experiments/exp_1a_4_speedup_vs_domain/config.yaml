# Experiment 1.A.4: Speedup vs Domain
# Research Question: Does EAB efficiency vary across different domains?
# Hypothesis: Higher uncertainty domains (creative) show greater speedup

experiment:
  name: "exp_1a_4_speedup_vs_domain"
  description: "Measure EAB speedup across different task domains (natural EAB behavior)"
  date_created: "2025-01-07"
  parent_experiment: "1.A - Efficiency Analysis"
  sub_experiment: "4 of 4"

# Model configuration (FIXED)
model:
  name: "Qwen/Qwen2.5-3B-Instruct"
  device: "cuda"
  dtype: "float16"

# Generation parameters (FIXED)
generation:
  max_new_tokens: 30
  temperature: 0.8
  top_p: 1.0
  do_sample: true

# EAB parameters (FIXED)
eab:
  entropy_threshold: 0.055
  branch_factor: 3
  max_paths: 20

# Naive sampling parameters (will match EAB sample count)
naive:
  temperature: 0.8
  top_p: 1.0

# Fair Comparison Protocol:
# 1. Run EAB with natural behavior → generates N samples (varies by prompt)
# 2. Run Naive N times → match EAB's sample count
# 3. Compare costs fairly

# Independent Variable: Domain
domains:
  - name: "factual_qa"
    description: "Factual question answering (low uncertainty)"
    prompts_file: "prompts/factual_qa_prompts.json"
  - name: "creative"
    description: "Creative writing (high uncertainty)"
    prompts_file: "prompts/creative_prompts.json"
  - name: "code"
    description: "Code generation (medium uncertainty)"
    prompts_file: "prompts/code_prompts.json"

# Fixed Variables
prompt_length: 200  # tokens (FIXED, approximately)
prompts_per_domain: 10  # number of prompts to test per domain

# Debug mode (for quick testing)
debug:
  enabled: true
  domains:
    - name: "factual_qa"
      description: "Factual question answering"
      prompts_file: "prompts/factual_qa_prompts.json"
    - name: "creative"
      description: "Creative writing"
      prompts_file: "prompts/creative_prompts.json"
  prompts_per_domain: 2  # Only 2 prompts per domain

# Metrics to track
metrics:
  cost:
    - "token_steps"        # Total forward passes × tokens (FLOPs proxy)
    - "wall_clock_time"    # Real execution time (seconds)
    - "memory_peak_mb"     # Peak memory usage (MB)
    - "tokens_per_sample"  # Total tokens / number of samples

  efficiency:
    - "speedup_factor"     # Naive cost / EAB cost
    - "cost_ratio"         # EAB cost / Naive cost

  branching:
    - "branch_count"       # Total number of branches
    - "branch_frequency"   # Branches per token position
    - "avg_branch_position"  # Average token position where branching occurs
    - "final_path_count"   # Number of active paths at end

  domain_specific:
    - "avg_entropy"        # Average entropy per domain
    - "entropy_variance"   # Variance in entropy (uncertainty)

# Output configuration
output:
  save_raw_results: true
  save_intermediate: true
  save_generated_texts: true
  results_dir: "results"
  figures_dir: "results/figures"
  texts_dir: "results/generated_texts"

# Reproducibility
seed: 42
